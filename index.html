<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L√∏vbjerg Ordresystem</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --red:#d70000;
  --red-dark:#a80000;
  --green:#16a34a;
  --green-light:#4ade80;
  --bg:#f3f5fb;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --border:#e5e7eb;
  --radius:18px;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Inter',system-ui,sans-serif;
  background:radial-gradient(circle at top left,#ffffff 0%,#f2f4fa 45%,#eceff7 100%);
  color:var(--text);
  padding:26px;
}

/* HEADER */
.app-header{
  background:linear-gradient(135deg,var(--red),#ff4d4d);
  color:white;
  padding:28px;
  border-radius:30px;
  box-shadow:0 22px 45px rgba(215,0,0,.35);
  margin-bottom:50px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:12px;
}
.app-header h1{margin:0;font-size:2rem;}
.sub{opacity:.9;}
.date{font-weight:700;}

/* TABS */
.tabs{
  display:flex;
  gap:10px;
  background:white;
  padding:8px;
  border-radius:22px;
  width:fit-content;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  margin-bottom:32px;
}
.tabs button{
  all:unset;
  cursor:pointer;
  padding:12px 22px;
  border-radius:16px;
  font-weight:700;
  color:var(--muted);
  transition:.25s;
}
.tabs button.active{
  background:linear-gradient(135deg,var(--red),#ff4d4d);
  color:white;
  box-shadow:0 8px 18px rgba(215,0,0,.45);
}

/* TOOLBAR */
.top-bar{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  margin-bottom:22px;
}
input, select, textarea{
  padding:14px 16px;
  border-radius:14px;
  border:1px solid var(--border);
  font-size:1rem;
  width:100%;
}
textarea{height:80px;}
.btn{
  border:none;
  border-radius:14px;
  padding:14px 20px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,var(--red),#ff4d4d);
  color:white;
  box-shadow:0 10px 22px rgba(215,0,0,.35);
  transition:.2s;
}
.btn:hover{transform:translateY(-1px);box-shadow:0 14px 26px rgba(215,0,0,.4);}
.btn:active{transform:scale(.96);}
.btn.secondary{
  background:linear-gradient(135deg,var(--red),#ff4d4d);
  color:white;
  box-shadow:0 10px 22px rgba(215,0,0,.35);
}
.btn.success{
  background:linear-gradient(135deg,var(--green),var(--green-light));
  box-shadow:0 10px 22px rgba(22,163,74,.35);
}

/* SECTIONS */
.section{
  background:white;
  border-radius:28px;
  padding:22px;
  box-shadow:0 12px 35px rgba(0,0,0,.08);
  margin-bottom:28px;
}
.order,.customer{
  background:linear-gradient(180deg,#ffffff,#f7f8fc);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  margin-bottom:12px;
  transition:.2s;
  position:relative;
}
.order:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(0,0,0,.08);}
.order.done{opacity:.4;filter:grayscale(1);border-left:4px solid var(--green);}
.order.afhentet{
  color:#6b7280;
  background: repeating-linear-gradient(
    45deg,
    #f3f4f6,
    #f3f4f6 10px,
    #e5e7eb 10px,
    #e5e7eb 20px
  );
  text-decoration:line-through;
}
.order.afhentet::after{
  content:"AFHENTET";
  position:absolute;
  top:8px;
  right:12px;
  font-weight:700;
  color:var(--red-dark);
}

/* ACTIONS */
.actions{
  margin-top:12px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.actions button{
  font-size:.75rem;
  padding:8px 12px;
  border-radius:10px;
  border:none;
  font-weight:700;
  cursor:pointer;
  transition:.2s;
}
.actions button.edit{background:linear-gradient(135deg,#facc15,#eab308);color:white;box-shadow:0 6px 14px rgba(250,204,21,.35);}
.actions button.ready{background:linear-gradient(135deg,var(--green),var(--green-light));color:white;box-shadow:0 6px 14px rgba(22,163,74,.35);}
.actions button.picked{background:linear-gradient(135deg,var(--green),var(--green-light));color:white;box-shadow:0 6px 14px rgba(22,163,74,.35);}
.actions button.delete{background:linear-gradient(135deg,var(--red),#ff4d4d);color:white;box-shadow:0 6px 14px rgba(215,0,0,.35);}
.actions button:hover{transform:translateY(-1px);}
.actions button:active{transform:scale(.95);}

/* MODALS */
.modal-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
  backdrop-filter: blur(4px);
}
.modal{
  background:linear-gradient(180deg,#ffffff,#f6f7fb);
  border-radius:28px;
  padding:28px;
  width:100%;
  max-width:520px;
  display:flex;
  flex-direction:column;
  gap:14px;
  box-shadow:0 30px 60px rgba(0,0,0,.35);
  animation:pop .25s ease;
}
@keyframes pop{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}
.modal h3{margin:0 0 6px 0;font-size:1.4rem;}
.modal label{display:flex;align-items:center;gap:10px;font-weight:600;}
.modal input[type="checkbox"]{width:22px;height:22px;accent-color:var(--red);}
ul{list-style:none;padding:0;margin:0;max-height:160px;overflow:auto;}
li{background:#f3f4f6;padding:6px 10px;border-radius:10px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;}
li button{background:#ef4444;border:none;color:white;border-radius:8px;padding:4px 8px;cursor:pointer;}
.tab-content{display:none;}
.tab-content.active{display:block;}
</style>
</head>
<body>

<div class="app-header">
  <div>
    <h1>L√∏vbjerg Ordresystem</h1>
    <div class="sub">Ordrer, faste kunder & gavekurve</div>
  </div>
  <div class="date" id="currentDate"></div>
</div>

<div class="tabs">
  <button class="active" onclick="showTab('ordersTab',this)">üì¶ Ordrer</button>
  <button onclick="showTab('customersTab',this)">üë§ Faste kunder</button>
  <button onclick="showTab('giftsTab',this)">üéÅ Gavekurve</button>
</div>

<!-- ORDRER TAB -->
<div id="ordersTab" class="tab-content active">
  <div class="top-bar">
    <button class="btn" onclick="showAddModal()">‚ûï Opret ordre</button>
    <input id="search" placeholder="S√∏g kunde..." oninput="renderOrders()">
    <button class="btn secondary" onclick="printToday()">üñ®Ô∏è Print</button>
    <button class="btn secondary" onclick="clearAllData()">üóëÔ∏è Ryd</button>
  </div>
  <div id="orders-today" class="section"></div>
  <div id="orders-future" class="section"></div>
</div>

<!-- KUNDER TAB -->
<div id="customersTab" class="tab-content">
  <div class="top-bar">
    <button class="btn" onclick="showAddModal()">‚ûï Tilf√∏j fast kunde</button>
  </div>
  <div id="customerContainer" class="section"></div>
</div>

<!-- GAVEKURVE TAB -->
<div id="giftsTab" class="tab-content">
  <div class="top-bar">
    <button class="btn" onclick="showAddGiftModal()">‚ûï Opret gavekurv</button>
  </div>
  <div id="giftContainer" class="section"></div>
</div>

<!-- ORDRER MODAL -->
<div id="addModal" class="modal-bg">
  <div class="modal">
    <h3>Opret / Rediger ordre</h3>
    <input id="addCustomer" placeholder="Firmanavn">
    <ul id="productList"></ul>
    <input id="addProductInput" placeholder="Tilf√∏j produkt">
    <button class="btn success" onclick="addProduct()">‚ûï Tilf√∏j produkt</button>
    <div style="display:flex;gap:10px">
      <input id="addDate" type="date">
      <input id="addTime" type="time">
    </div>
    <label><input type="checkbox" id="addRepeat"> Fast ugentlig aftale</label>
    <div style="display:flex;gap:10px;margin-top:10px">
      <button class="btn" onclick="submitAddOrder()">Gem</button>
      <button class="btn secondary" onclick="hideAddModal()">Annuller</button>
    </div>
  </div>
</div>

<!-- KLARGJORT MODAL -->
<div id="readyModal" class="modal-bg">
  <div class="modal">
    <h3>Klargjort</h3>
    <input id="readyNoteInput" placeholder="Hvor er varerne klargjort?">
    <div style="display:flex;gap:10px">
      <button class="btn" onclick="submitReady()">Gem</button>
      <button class="btn secondary" onclick="hideReadyModal()">Annuller</button>
    </div>
  </div>
</div>

<!-- GAVEKURV MODAL -->
<div id="giftModal" class="modal-bg">
  <div class="modal">
    <h3>Opret / Rediger gavekurv</h3>
    <input id="giftDate" type="date">
    <input id="giftBudget" type="number" placeholder="Budget">
    <input id="giftTarget" type="text" placeholder="M√•lgruppe">
    <textarea id="giftNote" placeholder="Noter til kurv"></textarea>
    <div style="display:flex;gap:10px;margin-top:10px">
      <button class="btn" onclick="submitGiftBasket()">Gem</button>
      <button class="btn secondary" onclick="hideAddGiftModal()">Annuller</button>
    </div>
  </div>
</div>

<script>
/* ===== INIT ===== */
updateDate();
let orders = JSON.parse(localStorage.getItem("orders")||"[]");
let nextId = orders.length ? Math.max(...orders.map(o=>o.id))+1 : 1;
let tempProducts=[], readyId=null, editId=null;

let giftBaskets = JSON.parse(localStorage.getItem("giftBaskets")||"[]");
let nextGiftId = giftBaskets.length ? Math.max(...giftBaskets.map(g=>g.id))+1 : 1;
let editGiftId=null;

/* ===== HELPERS ===== */
function save(){localStorage.setItem("orders",JSON.stringify(orders));}
function saveGifts(){localStorage.setItem("giftBaskets",JSON.stringify(giftBaskets));}
function today(){let d=new Date(); d.setHours(d.getHours()+1); return d.toISOString().split("T")[0];}
function addDays(d,n){const x=new Date(d); x.setDate(x.getDate()+n); return x.toISOString().split("T")[0];}
function weekday(d){return new Date(d).getDay();}

/* ===== TABS ===== */
function showTab(tab,btn){
  document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  document.getElementById(tab).classList.add("active");
  if(btn) btn.classList.add("active");
  if(tab==="customersTab") renderCustomers();
  if(tab==="giftsTab") renderGiftBaskets();
}

/* ===== ORDERS ===== */
function getInstance(o,d){ if(!o.instances)o.instances={}; if(!o.instances[d])o.instances[d]={readyNote:"",afhentet:false}; return o.instances[d]; }

function orderCard(o,isToday,isGenerated){
  const inst = getInstance(o,o.date);
  const div=document.createElement("div");
  div.className="order "+(inst.afhentet?"afhentet":"");
  div.innerHTML=`
    <strong>${o.customer}</strong><br>
    ${o.products.join(", ")}<br>
    Afhentning: ${o.date} ${o.time||""}
    ${inst.readyNote?`<div style="opacity:.7;margin-top:6px">üì¶ ${inst.readyNote}</div>`:""}
    ${isToday && !isGenerated?`
    <div class="actions">
      <button class="ready" onclick="markReady(${o.id},'${o.date}')">Klargjort</button>
      <button class="picked" onclick="markPicked(${o.id},'${o.date}')">Afhentet</button>
      <button class="edit" onclick="editOrder(${o.id})">Rediger</button>
      <button class="delete" onclick="deleteOrder(${o.id})">Slet</button>
    </div>`:""}
  `;
  return div;
}

function renderOrders(){
  const todayBox=document.getElementById("orders-today");
  const futureBox=document.getElementById("orders-future");
  todayBox.innerHTML="<h3>üìç Afhentes i dag</h3>";
  futureBox.innerHTML="<h3>üìÜ Kommende afhentninger (7 dage)</h3>";
  const q=document.getElementById("search").value.toLowerCase();
  let t=0,f=0;
  const next7=[...Array(7)].map((_,i)=>addDays(today(),i+1));
  orders.forEach(o=>{
    if(!o.customer.toLowerCase().includes(q)) return;
    if(o.date===today()){todayBox.appendChild(orderCard(o,true,false)); t++;}
    if(o.repeat){
      next7.forEach(d=>{if(weekday(d)===weekday(o.date)) futureBox.appendChild(orderCard({...o,date:d},false,true)); f++;});
    } else if(o.date>today()){futureBox.appendChild(orderCard(o,false,false)); f++;}
  });
  if(!t) todayBox.innerHTML+="<p>Ingen ordrer i dag</p>";
  if(!f) futureBox.innerHTML+="<p>Ingen kommende ordrer</p>";
}

/* ===== HANDLERS ===== */
function markReady(id,date){readyId={id,date};readyNoteInput.value=getInstance(orders.find(o=>o.id===id),date).readyNote;readyModal.style.display="flex";}
function submitReady(){const o=orders.find(o=>o.id===readyId.id);getInstance(o,readyId.date).readyNote=readyNoteInput.value;hideReadyModal();save();renderOrders();}
function hideReadyModal(){readyModal.style.display="none";}
function markPicked(id,date){const o=orders.find(o=>o.id===id);getInstance(o,date).afhentet=true;save();renderOrders();}
function editOrder(id){const o=orders.find(o=>o.id===id); if(o) showAddModal(o);}
function deleteOrder(id){if(confirm("Slet ordre?")){orders=orders.filter(o=>o.id!==id);save();renderOrders();renderCustomers();}}

/* ===== ADD / EDIT ORDER ===== */
function showAddModal(order=null){
  tempProducts=[];
  if(order){
    editId=order.id;
    addCustomer.value=order.customer;
    order.products.forEach(p=>tempProducts.push(p));
    addDate.value=order.date;
    addTime.value=order.time;
    addRepeat.checked=order.repeat;
  } else { editId=null; addCustomer.value=""; addDate.value=today(); addTime.value=""; addRepeat.checked=false; }
  addProductInput.value="";
  renderTemp();
  addModal.style.display="flex";
}
function hideAddModal(){
  addModal.style.display="none";
}

/* ===== PRODUKTER I ORDRE ===== */
function addProduct(){
  const val = addProductInput.value.trim();
  if(!val) return;
  tempProducts.push(val);
  addProductInput.value="";
  renderTemp();
}
function removeTemp(i){
  tempProducts.splice(i,1);
  renderTemp();
}
function renderTemp(){
  productList.innerHTML="";
  tempProducts.forEach((p,i)=>{
    const li=document.createElement("li");
    li.innerHTML=`${p} <button onclick="removeTemp(${i})">‚úñ</button>`;
    productList.appendChild(li);
  });
}

/* ===== GEM ORDRE ===== */
function submitAddOrder(){
  if(!addCustomer.value.trim()||!tempProducts.length||!addDate.value) 
    return alert("Udfyld alle felter");

  if(editId){
    let o=orders.find(o=>o.id===editId);
    o.customer=addCustomer.value;
    o.products=[...tempProducts];
    o.date=addDate.value;
    o.time=addTime.value;
    o.repeat=addRepeat.checked;
  } else {
    orders.push({
      id:nextId++,
      customer:addCustomer.value,
      products:[...tempProducts],
      date:addDate.value,
      time:addTime.value,
      repeat:addRepeat.checked,
      instances:{}
    });
  }
  save();
  hideAddModal();
  renderOrders();
  renderCustomers();
}

/* ===== KUNDER ===== */
function renderCustomers(){
  const container=document.getElementById("customerContainer");
  container.innerHTML="<h3>üë§ Faste kunder</h3>";
  const list=orders.filter(o=>o.repeat);
  if(!list.length){ container.innerHTML+="<p>Ingen faste kunder</p>"; return;}
  list.forEach(o=>{
    const div=document.createElement("div");
    div.className="customer";
    div.innerHTML=`
      <strong>${o.customer}</strong><br>
      ${o.products.join(", ")}<br>
      Afhentning: ${o.time||""}
      <div class="actions">
        <button class="edit" onclick="editOrder(${o.id})">Rediger</button>
        <button class="delete" onclick="deleteOrder(${o.id})">Slet</button>
      </div>`;
    container.appendChild(div);
  });
}

/* ===== PRINT / RYD ===== */
function printToday(){
  const list=orders.filter(o=>o.date===today());
  const w=window.open("");
  w.document.write("<h1>Dagens ordrer</h1>");
  list.forEach(o=>{
    w.document.write(`<p><strong>${o.customer}</strong><br>
      ${o.products.join(", ")}<br>
      Afhentning: ${o.time||""}</p><hr>`);
  });
  w.print();
}
function clearAllData(){
  if(confirm("Slet ALT data?")){
    localStorage.clear();
    location.reload();
  }
}

/* ===== GAVEKURVE ===== */
function showAddGiftModal(g=null){
  editGiftId=null;
  giftDate.value=today();
  giftBudget.value="";
  giftTarget.value="";
  giftNote.value="";
  if(g){
    editGiftId=g.id;
    giftDate.value=g.date;
    giftBudget.value=g.budget;
    giftTarget.value=g.target;
    giftNote.value=g.note;
  }
  giftModal.style.display="flex";
}
function hideAddGiftModal(){giftModal.style.display="none";}

function submitGiftBasket(){
  if(!giftDate.value||!giftBudget.value) return alert("Udfyld felter");
  if(editGiftId){
    let g=giftBaskets.find(x=>x.id===editGiftId);
    g.date=giftDate.value;
    g.budget=giftBudget.value;
    g.target=giftTarget.value;
    g.note=giftNote.value;
  } else {
    giftBaskets.push({
      id:nextGiftId++,
      date:giftDate.value,
      budget:giftBudget.value,
      target:giftTarget.value,
      note:giftNote.value
    });
  }
  saveGifts();
  hideAddGiftModal();
  renderGiftBaskets();
}

function renderGiftBaskets(){
  const c=document.getElementById("giftContainer");
  c.innerHTML="<h3>üéÅ Gavekurve</h3>";
  if(!giftBaskets.length){c.innerHTML+="<p>Ingen gavekurve</p>";return;}
  giftBaskets.forEach(g=>{
    const d=document.createElement("div");
    d.className="order";
    d.innerHTML=`
      <strong>Afhentning:</strong> ${g.date}<br>
      <strong>Budget:</strong> ${g.budget} kr<br>
      <strong>M√•lgruppe:</strong> ${g.target||"-"}<br>
      <strong>Noter:</strong> ${g.note||"-"}
      <div class="actions">
        <button class="edit" onclick="showAddGiftModal(giftBaskets.find(x=>x.id===${g.id}))">Rediger</button>
        <button class="delete" onclick="deleteGiftBasket(${g.id})">Slet</button>
      </div>`;
    c.appendChild(d);
  });
}
function deleteGiftBasket(id){
  if(confirm("Slet gavekurv?")){
    giftBaskets=giftBaskets.filter(g=>g.id!==id);
    saveGifts();
    renderGiftBaskets();
  }
}

/* ===== DATO ===== */
function updateDate(){
  const d=new Date();
  currentDate.textContent=d.toLocaleDateString("da-DK",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
}

/* ===== START ===== */
renderOrders();
renderCustomers();
renderGiftBaskets();
setInterval(()=>{updateDate();renderOrders();},60000);
</script>
</body>
</html>

